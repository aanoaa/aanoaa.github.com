<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Heroku | Mustache :{]]></title>
  <link href="http://aanoaa.github.io/blog/categories/heroku/atom.xml" rel="self"/>
  <link href="http://aanoaa.github.io/"/>
  <updated>2017-04-28T00:51:38+09:00</updated>
  <id>http://aanoaa.github.io/</id>
  <author>
    <name><![CDATA[Hyungsuk Hong]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[P5-hubot Onto Heroku]]></title>
    <link href="http://aanoaa.github.io/blog/2013/06/10/p5-hubot-onto-heroku/"/>
    <updated>2013-06-10T17:31:00+09:00</updated>
    <id>http://aanoaa.github.io/blog/2013/06/10/p5-hubot-onto-heroku</id>
    <content type="html"><![CDATA[<p>오리지날 <a href="https://github.com/github/hubot">hubot</a> 에는
<a href="https://www.heroku.com/">heroku</a> 어쩌고 저쩌고 하는 기능이 있습니다.</p>

<p>이제 <a href="https://github.com/aanoaa/p5-hubot">p5-hubot</a> 에서도 됩니다.</p>

<h3>OVERVIEW</h3>

<pre><code class="bash">$ cpanm Hubot                      # requires Hubot &gt;= 0.2.0
$ hubot --create /path/to/hubot    # 배치가능한 형태의 패키지 저장소를 생성합니다
$ cd /path/to/hubot
$ git init ; git add . ; git commit -m "init commit"

$ heroku create --stack cedar --buildpack https://github.com/aanoaa/heroku-buildpack-perl.git

$ heroku config:add HEROKU_URL=http://your-herokuapp.herokuapp.com
$ heroku config:add HUBOT_IRC_ROOMS='#channel'
$ heroku config:add HUBOT_IRC_SERVER='irc.freenode.net'

$ git push heroku master
</code></pre>

<p>가장 기본은 이렇습니다만, 확장 스크립트를 추가하시려면
<code>hubot-scripts.json</code> 파일에 적어주시고 그에 따른 모듈 의존성은
<code>cpanfile</code> 에 적어서 해결해야 합니다.</p>

<h3>CREATE A DEPLOYABLE HUBOT</h3>

<p><a href="http://search.cpan.org/">CPAN</a> 을 이용한다면,</p>

<pre><code>$ cpanm Hubot
$ hubot -c ~/Desktop/hubot
</code></pre>

<p>명령어로 deploy 저장소를 만들 수 있습니다.</p>

<pre><code>$ cd ~/Desktop/hubot/
~/Desktop/hubot $ find
.
./.gitignore
./cpanfile
./hubot-scripts.json
./bin
./bin/hubot
./README.md
./lib
./lib/Hubot
./lib/Hubot/EventEmitter.pm
./lib/Hubot/Scripts
./lib/Hubot/Scripts/help.pm
./lib/Hubot/Scripts/ascii.pm
./lib/Hubot/Scripts/shorten.pm
./lib/Hubot/Scripts/tweet.pm
./lib/Hubot/Scripts/roles.pm
./lib/Hubot/Response.pm
./lib/Hubot/Robot.pm
./lib/Hubot/User.pm
./lib/Hubot/Adapter.pm
./lib/Hubot/TextListener.pm
./lib/Hubot/Listener.pm
./lib/Hubot/Adapter
./lib/Hubot/Adapter/Irc.pm
./lib/Hubot/Adapter/Shell.pm
./lib/Hubot/Adapter/Campfire.pm
./lib/Hubot/Message.pm
./lib/Hubot/Brain.pm
./lib/Hubot/Creator.pm
./lib/Hubot.pm
./Procfile
</code></pre>

<p>이 디렉토리를 git 저장소로 만들고요, <code>heroku</code> tool 을 사용해서 heroku
에서 돌아갈 서비스 저장소로 만듭니다.</p>

<p><code>Procfile</code> 은 heroku 에서 사용하는 process 타입별로 실행 명령어를
담고 있는 어쩌고 저쩌고;;
<a href="https://devcenter.heroku.com/articles/procfile">Process Types and the Procfile</a></p>

<p><code>cpanfile</code> 은 모듈의존성을 해결하기 위해 꼭 필요합니다. 그렇지 않으면
아래와 비슷한 오류가 발생되면서 프로그램이 실행되지 않습니다.</p>

<pre><code>Can't locate xxx.pm in @INC (@INC contains: ~~~) at line 1.
</code></pre>

<p>나머지는 p5-hubot core 모듈입니다.(서비스엔 필요없는것도 잇지만..)</p>

<h3>CREATE A HEROKU INSTANCE?</h3>

<pre><code>$ heroku create --stack cedar --buildpack https://github.com/aanoaa/heroku-buildpack-perl.git
</code></pre>

<p><code>heroku</code> 라는 <code>remote</code> 를 등록하고 <code>BUILDPACK_URL</code> 설정변수를 추가하는
것 정도가 아닐까 추측 합니다.</p>

<p>BUILDPACK_URL 은 git 저장소인데,</p>

<ul>
<li><code>bin/detect</code></li>
<li><code>bin/compile</code></li>
<li><code>bin/release</code></li>
</ul>


<p>를 가지고 있습니다. 자세한 내용은
<a href="https://devcenter.heroku.com/articles/buildpacks#creating-a-buildpack">Creating a Buildpack</a>
을 참고하시고, 이부분의 매직은 <code>bin/compile</code> 이 수행될때 <code>cpanm</code> 을
이용해서 <code>./local</code> 에 의존모듈을 설치합니다. 그리고 실행할때에
<code>-Ilocal/perl5/lib</code> <code>PERL5LIB</code> 에 추가합니다. 풀어쓰면 아래와
같습니다.</p>

<pre><code>$ cpanm --quiet --notest -l $BUILD_DIR/local --installdeps .
</code></pre>

<p><a href="https://twitter.com/miyagawa">@miyagawa</a>++ 입니다.</p>

<p>그리고 heroku 에 push 하면 알아서 돌아갑니다(별일 없으면..)</p>

<h3>SEE ALSO</h3>

<ul>
<li><a href="https://github.com/github/hubot/wiki/Deploying-Hubot-onto-Heroku">Deploying Hubot onto Heroku</a></li>
<li><a href="https://github.com/aanoaa/heroku-buildpack-perl">heroku-buildpack-perl for Perl/hubot</a></li>
<li><a href="https://devcenter.heroku.com/articles/procfile">Process Types and the Procfile</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
