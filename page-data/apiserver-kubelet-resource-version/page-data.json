{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/apiserver-kubelet-resource-version/","result":{"data":{"site":{"siteMetadata":{"title":"Mustache :{","social":[{"name":"rss","url":"https://aanoaa.github.io/rss.xml"},{"name":"GitHub","url":"https://github.com/gatsbyjs"}]}},"blogPost":{"id":"887cf029-4f40-532d-b27d-9b3ae41853ca","excerpt":"on-premise 에서 운영중이던  1.20  클러스터에서  KubeAPIErrorBudgetBurn  alert 이 발생 The API server is burning too much error budget.\nAPI…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"kubelet 요청에 대한 kube-apiserver 의 응답실패\",\n  \"date\": \"2021-03-12T00:00:00.000Z\",\n  \"categories\": \"kubernetes api-server kubelet resourceVersion SLI errorbudget KubeAPIErrorBudgetBurn\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"on-premise \\uC5D0\\uC11C \\uC6B4\\uC601\\uC911\\uC774\\uB358 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1.20\"), \" \\uD074\\uB7EC\\uC2A4\\uD130\\uC5D0\\uC11C \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://monitoring.mixins.dev/kubernetes/#kube-apiserver-slos\"\n  }), \"KubeAPIErrorBudgetBurn\"), \" alert \\uC774 \\uBC1C\\uC0DD\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The API server is burning too much error budget.\\nAPI \\uC11C\\uBC84\\uAC00 \\uB108\\uBB34 \\uB9CE\\uC740 \\uC624\\uB958 \\uC608\\uC0B0\\uC744 \\uC18C\\uBAA8\\uD558\\uACE0 \\uC788\\uC2B5\\uB2C8\\uB2E4.\")), mdx(\"p\", null, \"\\uC6A9\\uC5B4\\uAC00 \\uC0DD\\uC18C\\uD574\\uC11C \\uBB34\\uC11C\\uC6E1.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://sre.google/workbook/alerting-on-slos/#4-alert-on-burn-rate\"\n  }), \"burn rate\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.atlassian.com/incident-management/kpis/error-budget\"\n  }), \"error budget\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"SLI: Service Level Indicator\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"SLA: Service Level Agreement\")), mdx(\"p\", null, \"\\uC5BC\\uCD94 SLA \\uAC00 99% \\uB77C\\uACE0 \\uAC00\\uC815\\uD55C\\uB2E4\\uBA74, (\\uC6B0\\uB9AC \\uC11C\\uBE44\\uC2A4\\uB294 \\uC5F0 99% \\uC758 \\uAC00\\uC6A9\\uC131\\uC744 \\uBCF4\\uC7A5\\uD569\\uB2C8\\uB2E4. \\uB77C\\uACE0 \\uBEE5\\uCCE4\\uB2E4\\uBA74..)\\nburn rate \\uAC00 \\uB298\\uC5B4\\uB098\\uBA74 \\uC774\\uB97C \\uB9CC\\uC871 \\uC2DC\\uD0AC \\uC218 \\uC5C6\\uC74C.\\n\\uC2DC\\uAC04\\uC774 \\uC9C0\\uB0A8\\uC5D0 \\uB530\\uB77C burn rate \\uC5D0 \\uBE44\\uB840\\uD574\\uC11C SLA \\uB3C4 \\uB0AE\\uC544\\uC9D0.\"), mdx(\"p\", null, \"\\uC774\\uB7EC\\uD55C \\uC0C1\\uD669\\uC744 \\uB300\\uBE44\\uD574\\uC11C \\uC804\\uBB38\\uAC00\\uD615\\uB2D8\\uB4E4\\uC774 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"KubeAPIErrorBudgetBurn\"), \" \\uC774\\uB77C\\uB294 alert rule \\uC744 \\uC815\\uC758\\uD574 \\uB193\\uC740 \\uAC83\\uC778\\uB370 \\uC774\\uAC8C \\uBC1C\\uC0DD.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"alert: KubeAPIErrorBudgetBurn\\nannotations:\\n  description: The API server is burning too much error budget.\\n  runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapierrorbudgetburn\\n  summary: The API server is burning too much error budget.\\nexpr: |\\n  sum(apiserver_request:burnrate1h) > (14.40 * 0.01000)\\n  and\\n  sum(apiserver_request:burnrate5m) > (14.40 * 0.01000)\\nfor: 2m\\nlabels:\\n  long: 1h\\n  severity: critical\\n  short: 5m\\n\")), mdx(\"p\", null, \"\\uB300\\uCDA9 \\uC4F0\\uBA74.. kube apiserver \\uC694\\uCCAD\\uC5D0\\uC11C \\uCD5C\\uADFC 1\\uC2DC\\uAC04\\uB3D9\\uC548 burnrate \\uB192\\uC73C\\uBA74 \\uBC1C\\uC0DD.\"), mdx(\"hr\", null), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"886px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"58.12641083521445%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAChUlEQVQoz01T2U4UURDtL3CW3rtvL9PL9GydIFtm2GYIywRmgRACAyMkGokPkuCriU+AiYokfoUSRVzj7x3rXhjl4eRUVVLnVteplphiwMnIKDsFPIzLmEgqSCwHjGpeToGdU6GZDJbjQ1YN5BUdhTBBsZyiECVQNFPUZfWWpVb7CNuHl+jvnKFH6G6fYmPnHJuD19h6dIHlzgsoqg63EEE3bAFNN0VNJbFRzTA5W5CaL9vY+j7Exsc9bF7tE4aCeb51c4Cld13k8wbCMMZEORKYrMT/cL82loSQVl7N4fBPF/vXa9j/uobhzbpgnh/87qD3oYVsVkcQUlO1iPEyCVUTwROVosAoHitFkKa3pzF/3MDsszoWns+icTSF5vEc6k+n0DqZx+RgnAQVuH6IpFyF4xZQLFXhBxHtMkZAe/RpHaVKCst2Idm2D9PwYRkemOlDU2zIeRPZjAYlbyGfM5CTNfhhEVFcgkmGmcwjuDAsJnKbDPNIVJiikDuZBwoYCxAEZcRxjR7wRC2bUWk6FapuwSIR3pDNq6I5pIvwgljU+IMcQrA4VkG6XEOtWUO6mCJtpSKuNquotWpI6gm5aSGiczJoGoMx6OZ/8Mc4NHKaszTzuI7hjz52PnWwe9Ul3DHlw299rF0sQpYNBPS5On2i7buikd/fSGwUc5ZmnpDgrz4Gn0nkSxeD694tE4Y/+1i/XIQim3TINTEFF+SN90XuQ2rsNtB5v4T2WQudtytonzfRebOM1dMF9C5XsXDSQC6nwfECMiYGK3iwXTLSIVOYI2LdsuH4BcGS60WwyF1D8+Aw+htUBy6LoXG2Q+gaE0YwOhf/zgS+y9HOeMwnM+lkZM3AX0GTdEXR2TAcAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"grafana-kube-apiserver\",\n    \"title\": \"grafana-kube-apiserver\",\n    \"src\": \"/static/c0afa538303d6a195f44b1e6e9ff394b/30295/grafana-kube-apiserver.png\",\n    \"srcSet\": [\"/static/c0afa538303d6a195f44b1e6e9ff394b/376d0/grafana-kube-apiserver.png 345w\", \"/static/c0afa538303d6a195f44b1e6e9ff394b/1dda8/grafana-kube-apiserver.png 690w\", \"/static/c0afa538303d6a195f44b1e6e9ff394b/30295/grafana-kube-apiserver.png 886w\"],\n    \"sizes\": \"(max-width: 886px) 100vw, 886px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"\\uC2E4\\uC81C\\uB85C grpc, http \\uC694\\uCCAD\\uC5D0 \\uB300\\uD574\\uC11C 404, 504 \\uC5D0\\uB7EC\\uAC00 1 rps \\uC815\\uB3C4\\uB85C \\uBC1C\\uC0DD.\"), mdx(\"p\", null, \"apiservice \\uB294 \\uC874\\uB098 \\uB9CE\\uC740\\uB370 \\uC5B4\\uB514\\uC5D0\\uC11C \\uBC1C\\uC0DD\\uD558\\uB294\\uAC70\\uC9C0? \\uB97C \\uD30C\\uC545\\uD574\\uC57C \\uD558\\uB294\\uB370, \\uCE5C\\uC808\\uD558\\uAC8C\\uB3C4 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"READ SLI - Errors\"), \" \\uC5D0 \\uC11C\\uBE44\\uC2A4\\uC774\\uB984\\uC774 \\uD45C\\uC2DC\\uB428.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"apiserver_request_total{code=\\\"504\\\"}\\n\")), mdx(\"p\", null, \"\\uB85C \\uC9C8\\uC758\\uD574\\uBCF4\\uB2C8\\uAE4C \\uAFB8\\uC900\\uD788 \\uC99D\\uAC00\\uD558\\uACE0 \\uC788\\uC5C8\\uC74C.\"), mdx(\"p\", null, \"kube api-server \\uB85C\\uADF8\\uC5D0\\uB294 \\uC2E4\\uD328\\uD55C request \\uC5D0 \\uB300\\uD55C \\uB85C\\uADF8\\uAC00 \\uB098\\uD0C0\\uB0A8.\\non-premise \\uD658\\uACBD\\uC774\\uB77C\\uC11C control plane \\uC740 pods \\uAC00 \\uC544\\uB2CC host \\uB178\\uB4DC\\uC5D0 docker \\uC11C\\uBE44\\uC2A4\\uB85C \\uC2E4\\uD589 \\uC911.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ docker logs -f kube-apiserver\\n...\\nI0311 06:34:27.831861       1 trace.go:205] Trace[499901619]: \\\"List\\\" url:/apis/node.k8s.io/v1beta1/runtimeclasses,user-agent:kubelet/v1.19.4 (linux/amd64) kubernetes/d360454,client:10.107.100.22 (11-Mar-2021 06:34:24.831) (total time: 3000ms):\\nTrace[499901619]: [3.000718126s] [3.000718126s] END\\nI0311 06:34:27.863066       1 trace.go:205] Trace[1117820138]: \\\"cacher list\\\" type:*storage.CSIDriver (11-Mar-2021 06:34:24.862) (total time: 3000ms):\\nTrace[1117820138]: [3.000170923s] [3.000170923s] END\\nI0311 06:34:27.863518       1 trace.go:205] Trace[1580916889]: \\\"List\\\" url:/apis/storage.k8s.io/v1/csidrivers,user-agent:kubelet/v1.19.4 (linux/amd64) kubernetes/d360454,client:10.107.100.16 (11-Mar-2021 06:34:24.862) (total time: 3000ms):\\nTrace[1580916889]: [3.000655319s] [3.000655319s] END\\nI0311 06:34:31.843461       1 trace.go:205] Trace[8763432]: \\\"cacher list\\\" type:*node.RuntimeClass (11-Mar-2021 06:34:28.843) (total time: 3000ms):\\nTrace[8763432]: [3.0001488s] [3.0001488s] END\\n\")), mdx(\"p\", null, \"\\uBB54\\uB9D0\\uC778\\uC9C0 \\uBAA8\\uB974\\uACA0\\uACE0, \\uC9C0\\uD45C\\uC5D0 \\uB098\\uD0C0\\uB09C csidriver \\uB791 runtimeclass api \\uBAA9\\uB85D\\uC870\\uD68C \\uC694\\uCCAD\\uC784. \\uC774\\uAC8C \\uC2E4\\uD328\\uD55C\\uB2E4\\uACE0?\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ kubectl get runtimeclass\\nNo resources found\\n\\n$ kubectl get csidriver\\nNAME                            ATTACHREQUIRED   PODINFOONMOUNT   MODES        AGE\\nrook-ceph.cephfs.csi.ceph.com   true             false            Persistent   38d\\nrook-ceph.rbd.csi.ceph.com      true             false            Persistent   38d\\n\")), mdx(\"p\", null, \"\\uC2E4\\uD328\\uC548\\uD558\\uB294\\uB370?\"), mdx(\"p\", null, \"kubectl \\uB9D0\\uACE0 api \\uC5D0 \\uB300\\uD55C raw \\uC694\\uCCAD\\uC744 \\uC2DC\\uB3C4.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ kubectl get --raw /apis/node.k8s.io/v1beta1/runtimeclasses | jq .\\n$ kubectl get --raw /apis/storage.k8s.io/v1/csidrivers | jq .\\n\")), mdx(\"p\", null, \"\\uB458\\uB2E4 OK.\"), mdx(\"p\", null, \"???\"), mdx(\"p\", null, \"\\uC544 \\uADF8\\uB0E5 EKS \\uC4F0\\uACE0 \\uC2F6\\uC74C.\"), mdx(\"p\", null, \"control plane \\uC5D0\\uB294 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/var/log/kube-audit/\"), \" \\uB514\\uB809\\uD1A0\\uB9AC\\uC5D0 audit log \\uAC00 \\uC313\\uC784.\"), mdx(\"p\", null, \"\\uC5EC\\uAE30\\uC5D0\\uC11C \\uC870\\uD68C\\uD558\\uB2C8\\uAE4C\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"  \\\"userAgent\\\": \\\"kubelet/v1.19.4 (linux/amd64) kubernetes/d360454\\\",\\n  \\\"requestURI\\\": \\\"/apis/node.k8s.io/v1beta1/runtimeclasses?resourceVersion=191700552\\\",\\n\")), mdx(\"p\", null, \"kubelet \\uC5D0\\uC11C \\uC624\\uB958\\uAC00 \\uBC1C\\uC0DD\\uD558\\uB294 apiservice \\uB97C \\uC774\\uC6A9\\uD560\\uB54C\\uC5D0 resourceVersion parameter \\uB97C \\uB118\\uACA8\\uC90C\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ kubectl get --raw /apis/node.k8s.io/v1beta1/runtimeclasses?resourceVersion=191700552 | jq .\\nError from server (Timeout): Timeout: Too large resource version: 191700552, current: 187970861\\n\")), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kubernetes/kubernetes/issues/91073\"\n  }), \"https://github.com/kubernetes/kubernetes/issues/91073\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"It handled the \\u201Ctoo old RV\\u201D error, but it doesn\\u2019t handle \\u201Ctoo large RV\\u201D correctly. What it should be doing instead is to:\")), mdx(\"p\", null, \"\\uC704 \\uD615\\uB2D8\\uAED8\\uC11C \\uC774\\uBBF8 \\uB2E4 \\uC54C\\uACE0 \\uACC4\\uC168\\uACE0 \\uD328\\uCE58 \\uD558\\uC168\\uC74C.\"), mdx(\"p\", null, \"\\uADFC\\uB370 \\uC65C \\uB098\\uB9CC? EKS \\uB85C \\uC62E\\uACA8\\uC57C..\"), mdx(\"p\", null, \"kubelet \\uC774 \\uC0AC\\uC6A9\\uD558\\uB294 resource version \\uC744 patch \\uD574\\uC8FC\\uBA74 \\uB418\\uC9C0 \\uC54A\\uC744\\uAE4C?\\n(configmap \\uB4F1\\uC744 \\uB4A4\\uC838\\uBD24\\uB294\\uB370 map \\uB370\\uC774\\uD130 \\uBABB\\uCC3E\\uACA0\\uC74C)\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kubernetes/kubernetes/issues/70674\"\n  }), \"https://github.com/kubernetes/kubernetes/issues/70674\")), mdx(\"p\", null, \"\\uADF8\\uB7F0\\uAC70 \\uC5C6\\uC74C.\"), mdx(\"p\", null, \"\\uADF8\\uB7EC\\uB358 \\uC640\\uC911\\uC5D0 audit log \\uC5D0\\uC11C source ip \\uB97C \\uBC1C\\uACAC\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"  \\\"sourceIPs\\\": [\\n    \\\"10.107.1.2\\\"\\n  ],\\n\")), mdx(\"p\", null, \"\\uC800\\uAC74 \\uC608\\uC804\\uC5D0 \\uC0AC\\uC6A9\\uD558\\uB358 worker \\uB178\\uB4DC\\uC758 ip.\"), mdx(\"p\", null, \"\\uB4E4\\uC5B4\\uAC00\\uBCF4\\uB2C8 kubelet \\uC774 \\uB5A0 \\uC788\\uC74C.\"), mdx(\"p\", null, \"\\uD640\\uB9AC..\"), mdx(\"hr\", null), mdx(\"p\", null, \"\\uCD94\\uC801\\uD558\\uBA74\\uC11C github \\uC774\\uC288 \\uBC0F \\uD328\\uCE58\\uB41C \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB4F1\\uC744 \\uD6D1\\uC5B4\\uBD24\\uB294\\uB370 \\uC874\\uB098 \\uB300\\uB2E8.\\n\\uC874\\uACBD\\uD569\\uB2C8\\uB2E4 \\uD615\\uB2D8\\uB4E4.\"), mdx(\"p\", null, \"\\uC774\\uB807\\uAC8C \\uC0AC\\uC774\\uC988\\uAC00 \\uD070 \\uD504\\uB85C\\uC81D\\uD2B8\\uB3C4 \\uC798 \\uAD74\\uB9AC\\uB294\\uAD6C\\uB098..\"), mdx(\"p\", null, \"\\uAD50\\uD6C8.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\uCCAD\\uC18C\\uB97C \\uC798\\uD558\\uC790.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"alert \\uB2D8 \\uB9D0\\uC500 \\uC798 \\uB4E3\\uC790.\")));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/apiserver-kubelet-resource-version/","title":"kubelet 요청에 대한 kube-apiserver 의 응답실패","tags":[],"keywords":[],"date":"March 12, 2021"},"previous":{"id":"fd306acb-087e-5511-8c5d-8edebcc108b2","excerpt":"어제 강남역 근처 어디 빵집(카페?) 갔는데, 프랑스밀가루 안데스솔트(소금) 을 사용한 프리미엄 빵을 팔더라.\n쬐간하고 비싸. 맛있냐면 뭐 그냥 빵. 안데스솔트 뭔데 프랑스밀가루 ㅋㅋㅋ 뒤진다.","slug":"/gangnam-bread/","title":"강남빵집","date":"February 27, 2021"},"next":null},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"887cf029-4f40-532d-b27d-9b3ae41853ca","previousId":"fd306acb-087e-5511-8c5d-8edebcc108b2"}}}